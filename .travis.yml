---
language: java

install: mvn  -V -DskipTests=true -Dmaven.javadoc.skip=true -B validate

script: mvn  -V --quiet clean verify -Dall-archs=true -Delexis.run.dbtests=true && find . -name "*.zip"
  
notifications:
  email:
  - niklaus.giger@member.fsf.org
jdk:
  - oraclejdk8

cache:
  directories:
  - $HOME/.m2

before_script:
# create postgres databases, user
  - psql -c "create database elexis_unit_tests;"
  - psql -c "create user elexis_unit_tests with UNENCRYPTED password 'elexisTest';"
  - psql -c "grant all privileges  on database elexis_unit_tests to elexis_unit_tests;"
  - mysql -lower-case-table-names=1 -e 'create database elexis_unit_tests;'
  - mysql -lower-case-table-names=1 -e "grant all on elexis_unit_tests.* to elexis_unit_tests@localhost identified by 'elexisTest';"
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start

services:
  - mysql
  - postgresql
