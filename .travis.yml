---
language: java

install: mvn  -V -DskipTests=true -Dmaven.javadoc.skip=true -B validate

script: mvn  -V --quiet clean verify -Dall-archs=true -Delexis.run.dbtests=true && find . -name "*.zip"
  
notifications:
  email:
  - niklaus.giger@member.fsf.org
jdk:
  - oraclejdk8

cache:
  directories:
  - $HOME/.m2

before_script:
# create postgres databases, user
# travis mysql accepts only username < 16 chare
  - psql --version
  - psql  -U postgres -c "create database elexis_ut;"
  - psql  -U postgres -c "create user elexis_ut with UNENCRYPTED password 'elexisTest';"
  - psql  -U postgres -c "grant all privileges  on database elexis_ut to elexis_ut;"
  - mysql --version
  - mysql -u root -e 'create database elexis_ut;'
  - mysql -u root -e "create user elexis_ut identified by 'elexisTest';"
  - mysql -u root -e "grant all on elexis_ut.* to elexis_ut@localhost identified by 'elexisTest';"
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start

services:
  - mysql
  - postgresql
